// Language translations (English / Vietnamese)
const translations = {
  en: {
    nav: {
      brand: "Phuquymermaids",
      home: "Home",
      about: "About",
      tours: "Tours",
      gallery: "Gallery",
      contact: "Contact",
    },
    hero: {
      title: "Dive Into Freedom",
      subtitle:
        "Experience the breathtaking beauty of Phú Quý Island through freediving",
      cta: "Book Your Adventure",
      scroll: "Scroll Down",
    },
    about: {
      title: "About Phuquymermaids",
      subtitle: "1-on-1 freediving and underwater media tours in Phú Quý",
      heading: "Dive, feel and be captured",
      p1: "Phuquymermaids is a small, dedicated team based on Phú Quý Island, specialising in 1-on-1 freediving experiences combined with underwater photo and video. Each session is designed so you can safely enjoy the ocean while we capture your most beautiful moments beneath the surface.",
      p2: "From your very first breath-hold to relaxed poses above the reef, our instructors and camera crew coach your technique, help you feel confident in front of the lens and choose the right angles, light and locations to tell your story in the water.",
      f1: {
        title: "1-on-1 instructors",
        desc: "Molchanovs-certified and internationally recognised freediving guides beside you throughout the dive",
      },
      f2: {
        title: "Professional media gear",
        desc: "Digital cameras, action cameras and dedicated underwater housings",
      },
      f3: {
        title: "Tailored sessions",
        desc: "Programs adjusted to your level – from curious beginners to ocean lovers",
      },
      f4: {
        title: "Local knowledge",
        desc: "Hand-picked dive sites around Phú Quý for light, visibility and safety",
      },
    },
    tours: {
      title: "Our Packages",
      subtitle: "Choose the perfect 1-on-1 freediving photo and video package",
      t1: {
        name: "1-on-1 ocean dive shoot – Action camera",
        badge: "Action camera",
        desc: "One-on-one freediving experience with a dedicated action camera filming your dives around Phú Quý.",
        f1: "Dedicated action camera (GoPro, DJI Action, Insta360 Ace Pro...)",
        f2: "1,800,000 VND per person / 2 sessions",
        f3: "08 edited photos (delivered 8–10 days after music selection)",
        f4: "All original files included",
        cta: "Book Action Camera Package",
      },
      t2: {
        name: "1-on-1 ocean dive shoot – Digital camera",
        badge: "Digital camera",
        desc: "Premium one-on-one freediving shoot using a digital camera plus additional action camera video.",
        f1: "Digital camera photos",
        f2: "Video recorded from dedicated action camera (GoPro, DJI Action 4, ...)",
        f3: "3,000,000 VND per person / 2 sessions",
        f4: "2,000,000 VND per person / 1 session",
        f5: "01 edited highlight video (delivered 8–10 days after music selection)",
        f6: "08 edited photos (delivered 8–10 days after photo selection)",
        f7: "All original files included",
        cta: "Book Digital Camera Package",
      },
    },
    included: {
      title: "What is included",
      subtitle: "Everything you get in each 1-on-1 freediving tour",
      i1Title: "1-on-1 instructor",
      i1Desc:
        "Professional instructor guiding you throughout the entire dive. Our Phu Quy Mermaids team holds international freediving certifications.",
      i2: "Freediving equipment (fins, mask, snorkel and other required gear)",
      i3: "Professional underwater photo and video equipment (Sony, GoPro, DJI, ...)",
      i4: "Canoe or SUP transfer, drinking water and fruits",
    },
    itinerary: {
      title: "Itinerary",
      subtitle: "Two-session 1-on-1 freediving schedule",
      d1Title: "Session 1",
      d1Time: "Afternoon 14:00 – 17:00",
      d1i1: "Canoe transfer or SUP from the beach to the dive spot",
      d1i2: "Introduction to freediving basics and safety",
      d1i3: "Tips on protecting the marine environment and coral reefs",
      d1i4: "Warm-up and getting familiar with equipment (mask, snorkel, fins, etc.)",
      d1i5: "Teaching basic freediving techniques (treading water, breathing, equalization, etc.)",
      d1i6: "Experience diving at depths from 3 m to 5 m",
      d2Title: "Session 2",
      d2Time: "Morning 8:00 – 11:00",
      d2i1: "Warm-up and review skills from session 1",
      d2i2: "Diving and creating poses for underwater shooting",
      d2i3: "Filming and photographing with professional equipment",
      note: "Schedule, dive site and transportation method may change depending on weather conditions to ensure the best experience for you.",
    },
    gallery: {
      title: "Diving Moments",
      subtitle: "Photos from our guests and freediving experiences at Phú Quý",
    },
    contact: {
      title: "Book Your Adventure",
      subtitle: "Get in touch to reserve your freediving experience",
      infoTitle: "Contact Information",
      location: "Location",
      phone: "Phone",
      formName: "Name",
      formPhone: "Phone",
      tourSelect: "Select a package",
      tourBeginner: "1-on-1 ocean dive shoot – Action camera",
      tourIntermediate: "1-on-1 ocean dive shoot – Digital camera",
      formMessage: "Message",
      formSubmit: "Send Inquiry",
    },
    footer: {
      brand: "Phuquymermaids",
      tagline:
        "Your trusted partner for freediving adventures in Phú Quý Island.",
      quickLinks: "Quick Links",
      follow: "Follow Us",
      moreMedia: "You can see more videos and photos on our channels:",
      igLabel: "Instagram",
      tiktokLabel: "TikTok",
      copyright: "© 2026 Phuquymermaids. All rights reserved.",
    },
    formSuccess: "Thank you for your inquiry! We will contact you soon.",
    zalo: { label: "Chat Zalo" },
  },
  vi: {
    nav: {
      brand: "Phuquymermaids",
      home: "Trang chủ",
      about: "Giới thiệu",
      tours: "Tour",
      gallery: "Ảnh lặn",
      contact: "Liên hệ",
    },
    hero: {
      title: "Lặn Tự Do",
      subtitle:
        "Trải nghiệm vẻ đẹp tuyệt vời đảo Phú Quý qua môn lặn freediving",
      cta: "Đặt tour ngay",
      scroll: "Cuộn xuống",
    },
    about: {
      title: "Về Phuquymermaids",
      subtitle: "Tour lặn tự do 1 kèm 1 kèm quay chụp tại đảo Phú Quý",
      heading: "Lặn, cảm nhận và lưu giữ khoảnh khắc",
      p1: "Phuquymermaids là đội ngũ nhỏ hoạt động tại đảo Phú Quý, chuyên về trải nghiệm lặn tự do 1 kèm 1 kết hợp quay chụp dưới nước. Mỗi buổi lặn được thiết kế để bạn vừa an toàn tận hưởng đại dương, vừa có những hình ảnh và video đẹp để mang về.",
      p2: "Từ những hơi nhịn thở đầu tiên đến các dáng pose trên rạn san hô, hướng dẫn viên và ekip quay chụp sẽ đồng hành, chỉnh tư thế, chọn góc và giúp bạn thoải mái trước ống kính để có được khoảnh khắc tự nhiên nhất.",
      f1: {
        title: "HDV 1 kèm 1",
        desc: "Đội ngũ HDV có chứng chỉ lặn tự do Molchanovs và quốc tế, theo sát suốt buổi lặn",
      },
      f2: {
        title: "Thiết bị chuyên nghiệp",
        desc: "Action camera, máy ảnh kỹ thuật số và housing dưới nước chuyên dụng",
      },
      f3: {
        title: "Lịch trình linh hoạt",
        desc: "Điều chỉnh theo thể lực và kinh nghiệm của từng khách",
      },
      f4: {
        title: "Hiểu biển Phú Quý",
        desc: "Chọn điểm lặn theo ánh sáng, tầm nhìn và điều kiện an toàn từng ngày",
      },
    },
    tours: {
      title: "Các gói quay chụp",
      subtitle: "Chọn gói quay chụp lặn biển 1 kèm 1 phù hợp với bạn",
      t1: {
        name: "Gói quay chụp lặn biển 1 kèm 1 – Action camera",
        badge: "Action camera",
        desc: "Trải nghiệm lặn tự do 1 kèm 1 cùng HDV, được quay lại bằng action camera chuyên dụng tại vùng biển Phú Quý.",
        f1: "Action camera chuyên dụng (GoPro, DJI Action, Insta360 Ace Pro...)",
        f2: "1.800.000 VND/người/2 buổi",
        f3: "08 hình ảnh đã chỉnh sửa (giao trong 8–10 ngày sau khi chọn nhạc)",
        f4: "Toàn bộ file gốc",
        cta: "Đặt gói Action camera",
      },
      t2: {
        name: "Gói quay chụp lặn biển 1 kèm 1 – Máy ảnh kỹ thuật số",
        badge: "Máy ảnh kỹ thuật số",
        desc: "Gói quay chụp cao cấp 1 kèm 1, chụp bằng máy ảnh kỹ thuật số và quay thêm video bằng action camera.",
        f1: "Máy ảnh kỹ thuật số",
        f2: "Video quay từ action camera chuyên dụng (GoPro, DJI Action 4,...)",
        f3: "3.000.000 VND/người/2 buổi",
        f4: "2.000.000 VND/người/1 buổi",
        f5: "01 video chỉnh sửa tổng hợp (giao trong 8–10 ngày sau khi chọn nhạc)",
        f6: "08 hình ảnh đã chỉnh sửa (giao trong 8–10 ngày sau khi chọn ảnh)",
        f7: "Toàn bộ file gốc",
        cta: "Đặt gói Máy ảnh kỹ thuật số",
      },
    },
    included: {
      title: "Tour bao gồm",
      subtitle: "Những gì bạn nhận được trong gói lặn biển 1 kèm 1",
      i1Title: "Hướng dẫn viên 1 kèm 1",
      i1Desc:
        "Đội ngũ HDV của Phu Quy Mermaids có chứng chỉ lặn quốc tế, đồng hành suốt quá trình lặn.",
      i2: "Thiết bị lặn (fins – chân nhái, kính lặn chuyên dụng, ống thở)",
      i3: "Thiết bị quay chụp dưới nước chuyên dụng (Sony, GoPro, DJI,...)",
      i4: "Cano di chuyển hoặc sup, nước khoáng, trái cây,...",
    },
    itinerary: {
      title: "Lịch trình",
      subtitle: "Hai buổi lặn 1 kèm 1 trong ngày",
      d1Title: "Buổi 1",
      d1Time: "(Chiều 14:00 - 17:00)",
      d1i1: "Cano đưa đón hoặc chèo sup từ bãi biển ra điểm lặn",
      d1i2: "Giới thiệu sơ lược về bộ môn lặn tự do (Freediving)",
      d1i3: "Tips lặn bảo vệ môi trường biển và san hô",
      d1i4: "Khởi động, làm quen với dụng cụ lặn (kính lặn, ống thở, chân nhái,...)",
      d1i5: "Hướng dẫn kỹ thuật lặn cơ bản (đứng nước, lấy hơi, xả áp tai,...)",
      d1i6: "Trải nghiệm lặn ở độ sâu từ 3m - 5m",
      d2Title: "Buổi 2",
      d2Time: "(Sáng 8:00 - 11:00)",
      d2i1: "Khởi động, ôn lại các kỹ thuật buổi 1",
      d2i2: "Lặn và tạo các dáng quay chụp dưới nước",
      d2i3: "Được quay phim và chụp ảnh bằng các thiết bị chuyên dụng",
      note: "Lưu ý: Thời gian, địa điểm lặn và hình thức di chuyển có thể thay đổi phụ thuộc vào thời tiết nhằm đem lại trải nghiệm tốt nhất cho bạn!",
    },
    gallery: {
      title: "Ảnh lặn",
      subtitle: "Ảnh từ khách và trải nghiệm freediving tại Phú Quý",
    },
    contact: {
      title: "Đặt tour",
      subtitle: "Liên hệ để đặt trải nghiệm freediving của bạn",
      infoTitle: "Thông tin liên hệ",
      location: "Địa điểm",
      phone: "Điện thoại",
      formName: "Họ tên",
      formPhone: "Điện thoại",
      tourBeginner: "Gói 1 kèm 1 – Action camera",
      tourIntermediate: "Gói 1 kèm 1 – Máy ảnh kỹ thuật số",
      tourAdvanced: "",
      formMessage: "Tin nhắn",
      formSubmit: "Gửi yêu cầu",
    },
    footer: {
      brand: "Phuquymermaids",
      tagline: "Đối tác tin cậy cho hành trình freediving tại đảo Phú Quý.",
      quickLinks: "Liên kết",
      follow: "Theo dõi",
      moreMedia:
        "Bạn có thể tham khảo thêm video/hình ảnh trên trang của tụi mình tại:",
      igLabel: "Instagram",
      tiktokLabel: "Tiktok",
      copyright: "© 2026 Phuquymermaids. Bảo lưu mọi quyền.",
    },
    formSuccess: "Cảm ơn bạn đã gửi yêu cầu! Chúng tôi sẽ liên hệ sớm.",
    zalo: { label: "Chat Zalo" },
  },
};

const LANG_KEY = "phuquymermaids-lang";

// Hero banner images - all images in static/hero_images
const HERO_IMAGES = [
  "static/hero_images/temp_image_058B2C99-8464-439E-B30A-60BF14BBF353.WEBP",
  "static/hero_images/temp_image_08242AA5-8A9C-405D-8154-9EC8F7597269.WEBP",
  "static/hero_images/temp_image_13927D59-0C3D-4365-B0DA-6E1199B0024A.WEBP",
  "static/hero_images/temp_image_1B39018B-50F8-4F24-81B2-E5183613CF45.WEBP",
  "static/hero_images/temp_image_330D51F2-A652-4DE1-B081-A6A923CB3827.WEBP",
  "static/hero_images/temp_image_35BDFA9D-CB6D-49B5-B122-29C3622AD53E.WEBP",
  "static/hero_images/temp_image_42B7085D-C083-4806-8F96-AA9F2DA49170.WEBP",
  "static/hero_images/temp_image_452A08A3-99BD-4552-ADEA-8E32EFC7E1E1.WEBP",
  "static/hero_images/temp_image_48B817DA-9FAC-42FE-906F-6F1D0DE85F03.WEBP",
  "static/hero_images/temp_image_4F7EB2FF-EB33-497B-BC3B-86E47D5C0015.WEBP",
  "static/hero_images/temp_image_586D52F9-C4B9-407D-BD4E-34B3713A5E6D.WEBP",
  "static/hero_images/temp_image_62927D0D-A9C7-41D9-AB76-E0FADF0A07A9.WEBP",
  "static/hero_images/temp_image_69C10164-57DE-42B4-9727-C61E28023D7E.WEBP",
  "static/hero_images/temp_image_6A9FEAC7-B464-4ECB-845A-DD2F30F52875.WEBP",
  "static/hero_images/temp_image_6C1CFDAF-1A77-481D-BBA9-8031C0153981.WEBP",
  "static/hero_images/temp_image_6F854586-175A-4B85-96C1-A47349123A33.WEBP",
  "static/hero_images/temp_image_7241138A-79B3-484E-A9F5-CF1BD99A4AD4.WEBP",
  "static/hero_images/temp_image_7A419330-0A49-4368-BC0B-BB05AE38FFE0.WEBP",
  "static/hero_images/temp_image_7C5B67AD-AA3C-4BF5-9B9B-1E639F0BF898.WEBP",
  "static/hero_images/temp_image_8046C01E-F11D-4BAA-A44E-C5DE2459A94C.WEBP",
  "static/hero_images/temp_image_8643FEAC-E303-4563-8722-691307CFB3DE.WEBP",
  "static/hero_images/temp_image_982ED9B4-D975-4B78-BC2A-32302DFEA99C.WEBP",
  "static/hero_images/temp_image_9AF6D1F5-EB0A-417D-B2A4-748106EBCCA7.WEBP",
  "static/hero_images/temp_image_9B0DC053-837E-43C2-8962-D2DDCCC16F2F.WEBP",
  "static/hero_images/temp_image_9E38415E-9496-428F-AFBA-043C68C0B74B.WEBP",
  "static/hero_images/temp_image_A2A81329-C571-4358-9D78-11885D4EE63D.WEBP",
  "static/hero_images/temp_image_A3BE2120-AF5F-42B6-85D6-913A2A730DB1.WEBP",
  "static/hero_images/temp_image_A7CDF8C0-6516-41A7-A372-BCD6497C99F6.WEBP",
  "static/hero_images/temp_image_AFB04C8E-23F1-446A-97AE-78502E2D0B4C.WEBP",
  "static/hero_images/temp_image_B1B16526-EA00-49CC-8F97-ABA73D2F9143.WEBP",
  "static/hero_images/temp_image_D2BBC360-EE9B-434C-A0EC-948F5B2A38A4.WEBP",
  "static/hero_images/temp_image_EB65BDB0-1FB3-4C29-8114-A391C27E3587.WEBP",
  "static/hero_images/temp_image_EC5A9828-ABD6-4770-B730-869C9295FBA4.WEBP",
  "static/hero_images/temp_image_F357529F-9731-44B1-9FA9-E20775ACDCB4.WEBP",
  "static/hero_images/temp_image_FD2CB1D0-2DD5-4809-8BC1-10EF4A0148A8.WEBP",
  "static/hero_images/temp_image_FF78E891-370E-4CC1-A080-9967D83CC6C0.WEBP",
];

function getNested(obj, path) {
  return path
    .split(".")
    .reduce((o, k) => (o && o[k] !== undefined ? o[k] : null), obj);
}

function applyLanguage(lang) {
  const t = translations[lang] || translations.en;
  document.documentElement.lang = lang === "vi" ? "vi" : "en";
  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const value = getNested(t, key);
    if (value != null) el.textContent = value;
  });
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.classList.toggle("active", btn.getAttribute("data-lang") === lang);
  });
  try {
    localStorage.setItem(LANG_KEY, lang);
  } catch (e) {}
}

document.querySelectorAll(".lang-btn").forEach((btn) => {
  btn.addEventListener("click", () => {
    const lang = btn.getAttribute("data-lang");
    if (translations[lang]) applyLanguage(lang);
  });
});

const savedLang =
  (typeof localStorage !== "undefined" && localStorage.getItem(LANG_KEY)) ||
  "en";
applyLanguage(savedLang);

// Hero banner slideshow - show 4 images at a time in a grid
const heroImageLayer = document.querySelector(".hero-image-layer");
if (heroImageLayer && HERO_IMAGES.length > 0) {
  const visibleCount = 4;
  const imageEls = [];

  for (let i = 0; i < visibleCount; i++) {
    const img = document.createElement("img");
    img.className = "hero-photo";
    heroImageLayer.appendChild(img);
    imageEls.push(img);
  }

  let heroIndex = 0;

  function updateHeroImagesWithPreload() {
    // Preload all 4 images, then swap once all are loaded
    let loadedCount = 0;

    for (let i = 0; i < visibleCount; i++) {
      const idx = (heroIndex + i) % HERO_IMAGES.length;
      const imgPath = HERO_IMAGES[idx];

      const preloader = new Image();
      preloader.onload = () => {
        imageEls[i].src = imgPath;
        imageEls[i].alt = `Hero photo ${idx + 1}`;
        loadedCount += 1;
        if (loadedCount === visibleCount) {
          heroImageLayer.style.opacity = 1;
        }
      };
      preloader.src = imgPath;
    }
  }

  // Initial load
  updateHeroImagesWithPreload();

  setInterval(() => {
    // Fade out whole layer, then update all 4 images together
    heroImageLayer.style.opacity = 0;
    heroIndex = (heroIndex + visibleCount) % HERO_IMAGES.length; // nhảy 4 ảnh mỗi lần
    setTimeout(() => {
      updateHeroImagesWithPreload();
    }, 400);
  }, 6000);
}

// Navigation toggle for mobile
const navToggle = document.querySelector(".nav-toggle");
const navMenu = document.querySelector(".nav-menu");

if (navToggle) {
  navToggle.addEventListener("click", () => {
    navMenu.classList.toggle("active");
  });
}

// Close mobile menu when clicking on a link
const navLinks = document.querySelectorAll(".nav-menu a");
navLinks.forEach((link) => {
  link.addEventListener("click", () => {
    navMenu.classList.remove("active");
  });
});

// Smooth scroll behavior
document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
  anchor.addEventListener("click", function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute("href"));
    if (target) {
      const offsetTop = target.offsetTop - 70; // Account for fixed navbar
      window.scrollTo({
        top: offsetTop,
        behavior: "smooth",
      });
    }
  });
});

// Navbar background on scroll
const navbar = document.querySelector(".navbar");
let lastScroll = 0;

window.addEventListener("scroll", () => {
  const currentScroll = window.pageYOffset;

  if (currentScroll > 100) {
    navbar.style.background = "rgba(10, 25, 41, 0.98)";
    navbar.style.boxShadow = "0 2px 10px rgba(0, 0, 0, 0.1)";
  } else {
    navbar.style.background = "rgba(10, 25, 41, 0.95)";
    navbar.style.boxShadow = "none";
  }

  lastScroll = currentScroll;
});

// Paste your Google Apps Script Web App URL here after deploying (see google-apps-script/Code.gs)
const GOOGLE_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbzNdIa18dJzI4P7hFbhEh1ypBP6w5OUKO8mCZiRvaT-PgxKuDnd2JSnF1R5FF7365Eb/exec";
const GOOGLE_SCRIPT_ID =
  "AKfycbxWxLV9zpkT4RymF2IyxskOHpT4ue1qDK2Br5BeLcIMaMJ1xgxonSp8XzLso9KBZJk";
// Form submission handler
const contactForm = document.getElementById("contactForm");

if (contactForm) {
  contactForm.addEventListener("submit", function (e) {
    e.preventDefault();

    const lang =
      (typeof localStorage !== "undefined" && localStorage.getItem(LANG_KEY)) ||
      "en";
    const msg =
      (translations[lang] && translations[lang].formSuccess) ||
      translations.en.formSuccess;

    if (GOOGLE_SCRIPT_URL) {
      this.action = GOOGLE_SCRIPT_URL;
      this.target = "_blank";
      this.submit();
    }

    alert(msg);
    this.reset();
  });
}

// Set minimum date for date input to today
const dateInput = document.getElementById("date");
if (dateInput) {
  const today = new Date().toISOString().split("T")[0];
  dateInput.setAttribute("min", today);
}

// Intersection Observer for fade-in animations
const observerOptions = {
  threshold: 0.1,
  rootMargin: "0px 0px -50px 0px",
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      entry.target.style.opacity = "1";
      entry.target.style.transform = "translateY(0)";
    }
  });
}, observerOptions);

// Observe elements for animation
document.addEventListener("DOMContentLoaded", () => {
  const animateElements = document.querySelectorAll(
    ".tour-card, .feature-item, .about-text, .gallery-item, .included-card, .itinerary-card"
  );
  animateElements.forEach((el) => {
    el.style.opacity = "0";
    el.style.transform = "translateY(20px)";
    el.style.transition = "opacity 0.6s ease, transform 0.6s ease";
    observer.observe(el);
  });
});

// Parallax removed so About section does not overlap the hero banner
